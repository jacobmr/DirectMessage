# HIPAA Direct Messaging Framework

A Python framework for sending HIPAA-compliant Direct messages with S/MIME encryption.

## Features

- Send Direct messages with S/MIME encryption
- Certificate management (generate, validate, inspect)
- HIPAA-compliant audit logging
- Support for attachments (medical records, images, etc.)
- Simple, clean API

## Installation

1. Clone this repository
2. Install dependencies:

```bash
pip install -r requirements.txt
```

For development:

```bash
pip install -r requirements-dev.txt
```

## Quick Start

### 1. Generate Test Certificates

```bash
python examples/generate_certificates.py
```

### 2. Configure Environment

Copy `.env.example` to `.env` and update with your SMTP settings:

```bash
cp .env.example .env
# Edit .env with your configuration
```

### 3. Send a Message

```bash
python examples/send_message.py
```

## Usage

### Basic Message

```python
from hipaa_direct import DirectMessage, DirectMessageSender

# Create message
message = DirectMessage(
    from_address="sender@direct.example.com",
    to_address="recipient@direct.example.com",
    subject="Test Message",
    body="This is a HIPAA-compliant Direct message."
)

# Send with encryption
sender = DirectMessageSender(
    smtp_host="smtp.example.com",
    smtp_port=587,
    smtp_user="username",
    smtp_password="password"
)

sender.send(
    message=message,
    sender_cert_path="certs/sender.crt",
    sender_key_path="certs/private/sender.key",
    recipient_cert_path="certs/recipient.crt"
)
```

### Message with Attachments

```python
message = DirectMessage(
    from_address="sender@direct.example.com",
    to_address="recipient@direct.example.com",
    subject="Medical Record",
    body="Please find the attached medical record.",
    attachments=[{
        "filename": "record.pdf",
        "content": pdf_bytes,
        "content_type": "application/pdf"
    }]
)
```

### Certificate Management

```python
from hipaa_direct import CertificateManager

cert_manager = CertificateManager()

# Generate self-signed certificate
cert_path, key_path = cert_manager.generate_self_signed_cert(
    email="provider@example.com",
    organization="Example Healthcare"
)

# Verify certificate
is_valid = cert_manager.verify_certificate(cert_path)

# Get certificate info
info = cert_manager.get_certificate_info(cert_path)
```

## Project Structure

```
src/hipaa_direct/
├── core/
│   ├── message.py        # Message construction and validation
│   └── sender.py         # Message sending with S/MIME
├── certs/
│   └── manager.py        # Certificate management
└── utils/
    └── logging.py        # HIPAA audit logging

examples/
├── generate_certificates.py
├── send_message.py
└── send_with_attachment.py

tests/
├── unit/                 # Unit tests
└── integration/          # Integration tests
```

## HIPAA Compliance

This framework includes:

- **Audit Logging**: All message operations are logged with timestamps
- **Encryption**: S/MIME encryption for message confidentiality
- **Access Control**: Certificate-based authentication
- **Integrity**: Digital signatures to prevent tampering

Audit logs are stored in the `logs/` directory in JSON format.

## Development

### Run Tests

```bash
pytest
```

### Run Tests with Coverage

```bash
pytest --cov=hipaa_direct --cov-report=html
```

### Code Formatting

```bash
black src/
```

### Linting

```bash
flake8 src/
mypy src/
```

## Security Notes

- **Never commit private keys or certificates** to version control
- Use environment variables for sensitive configuration
- Certificates should be obtained from trusted Certificate Authorities (CAs) for production
- The self-signed certificates generated by this tool are for **testing only**

## License

MIT License (or specify your license)

## Support

For issues or questions, please open an issue on GitHub.
